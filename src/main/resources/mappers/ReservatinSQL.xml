<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nts.reservation.dao.ReservationDao">

	<resultMap type="ReservationInfo" id="ReservationResultMap">
		<id column="id" property="id"/>
		<result column="cancel_flag" property="cancelFlage"/>
		<result column="create_date" property="createDate"/>
		<result column="display_info_id" property="displayInfoId"/>
		<result column="modify_date" property="modifyDate"/>
		<result column="product_id" property="productId"/>
		<result column="reservation_date" property="reservationDate"/>
		<result column="reservation_email" property="reservationEmail"/>
		<result column="reservation_name" property="reservationName"/>
		<result column="reservation_tel" property="reservationTelephone"/>
		<collection property="displayInfo" column="displayInfoId" ofType="displayInfo" select="com.nts.reservation.dao.DisplayDao.selectDisplayInfo"/>
	</resultMap>

	
	<select id="selectReservationList" parameterType="java.lang.String" resultMap="ReservationResultMap">
		SELECT
			id,
			cancel_flag 					AS cancelFlage,
			create_date 					AS createDate,
			display_info_id 				AS displayInfoId,
			modify_date 					AS modifyDate,
			product_id 						AS productId,
			reservation_date 				AS reservationDate,
			reservation_email 				AS reservationEmail,
			reservation_name 				AS reservationName,
			reservation_tel 				AS reservationTelephone
		FROM
			reservation_info
		WHERE
			reservation_info.reservation_email = #{email}
	</select>
	
	<insert id="insertReservationInfo" parameterType="map" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO 
			reservation_info (
				product_id, 
				display_info_id, 
				reservation_name, 
				reservation_tel, 
				reservation_email, 
				reservation_date, 
				cancel_flag, 
				create_date, 
				modify_date)
		VALUES (
			#{productId}, 
			#{displayInfoid}, 
			#{reservationName}, 
			#{reservationTelephone}, 
			#{reservationEmail}, 
			#{reservationDate}, 
			0, 
			NOW(), 
			NOW())
	</insert>
	
	<insert id="insertReservationInfoPrice" parameterType="map" useGeneratedKeys="true" keyProperty="priceInfoList.id">
		INSERT INTO
			reservation_info_price (
				reservation_info_id,
				product_price_id,
				count)
		VALUES 
			<foreach collection="priceInfoList" item="priceInfo" index="index" separator=",">
				(#{reservationInfoId},
				#{priceInfo.productPriceId},
				#{priceInfo.count})
			</foreach>
	</insert>

</mapper>